name: godot-web-deploy

on:
  push:
    branches:
      - main

env:
  GODOT_VERSION: 4.5
  EXPORT_NAME: pong
  PROJECT_PATH: .

jobs:
  web-build:
    name: Web
    runs-on: ubuntu-latest
    container:
      image: barichello/godot-ci:4.5
    steps:
    - name: Checkout
      uses: actions/checkout@v5
      with:
        lfs: true
    - name: Setup
      run: |
        mkdir -v -p ~/.local/share/godot/export_templates/
        mv /root/.local/share/godot/export_templates/${GODOT_VERSION}.stable ~/.local/share/godot/export_templates/${GODOT_VERSION}.stable
    - name: Web Build
      run: |
        mkdir -v -p build/web
        EXPORT_DIR="$(readlink -f build)"
        cd $PROJECT_PATH
        godot --headless --verbose --export-release "Web" "$EXPORT_DIR/web/index.html"
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: web
        path: build/web
    - name: Install rsync ðŸ“š
      run: |
        apt-get update && apt-get install -y rsync
    - name: Deploy to GitHub Pages ðŸš€
      uses: JamesIves/github-pages-deploy-action@releases/v4
      with:
        branch: gh-pages # The branch the action should deploy to.
        folder: build/web # The folder the action should deploy.
